services:

  # Bitcoin Core (SHA256 parent chain)
  bitcoind:
    image: lncm/bitcoind:v27.2
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/bitcoin:/data/.bitcoin
    command:
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=8332
      - -port=8333
      - -txindex=1
      - -printtoconsole
      - -dbcache=450
    ports:
      - "8332:8332"
      - "8333:8333"

  # Namecoin Core (SHA256 auxiliary chain, merge-mined with Bitcoin)
  namecoind:
    image: sevenrats/namecoin-core:latest
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/namecoin:/home/namecoin/.namecoin
    command:
      - namecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=8336
      - -port=8334
      - -txindex=1
      - -printtoconsole
    ports:
      - "8336:8336"

  # Litecoin Core (Scrypt parent chain)
  litecoind:
    image: uphold/litecoin-core:0.21
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/litecoin:/home/litecoin/.litecoin
    command:
      - litecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=9332
      - -port=9333
      - -txindex=1
      - -printtoconsole
    ports:
      - "9332:9332"
      - "9333:9333"

  # Dogecoin Core (Scrypt auxiliary chain, merge-mined with Litecoin)
  dogecoind:
    image: casperstack/dogecoin:latest
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/dogecoin:/root/.dogecoin
    command:
      - dogecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=22555
      - -port=22556
      - -txindex=1
      - -printtoconsole
    ports:
      - "22555:22555"

  # Pepecoin Core (Scrypt auxiliary chain, merge-mined with Litecoin)
  pepecoind:
    image: pepeenthusiast/pepecoin-core:latest
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/pepecoin:/home/pepecoin/.pepecoin
    command:
      - pepecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=29373
      - -port=29374
      - -printtoconsole
    ports:
      - "29373:29373"

  # Redis (share & stats storage)
  redis:
    image: redis:6-alpine
    restart: on-failure
    command: >-
      redis-server --appendonly yes --save 60 1 --maxmemory 1024mb
      --maxmemory-policy volatile-lru
    volumes:
      - ${APP_DATA_DIR}/data/redis:/data

  # MariaDB (YIIMP database)
  mariadb:
    image: mysql:5.7
    restart: on-failure
    environment:
      MYSQL_ROOT_PASSWORD: coiniumserv
      MYSQL_DATABASE: coiniumserv
      MYSQL_USER: coiniumserv
      MYSQL_PASSWORD: coiniumserv
    volumes:
      - ${APP_DATA_DIR}/data/mysql57:/var/lib/mysql

  # Umbrel App Proxy
  app_proxy:
    image: getumbrel/app-proxy:1.0.0
    environment:
      APP_HOST: coiniumserv
      APP_PORT: 8080
    ports:
      - "8080:8080"

  # CoiniumServ Mining Pool + Web Dashboard
  coiniumserv:
    image: ghcr.io/bobparkerbob888-tech/coiniumserv-mining-pool:latest
    restart: on-failure
    depends_on:
      - bitcoind
      - namecoind
      - litecoind
      - dogecoind
      - pepecoind
      - redis
      - mariadb
    environment:
      APP_PASSWORD: ${APP_PASSWORD:-umbrel}
      BTC_DAEMON_HOST: "bitcoind"
      BTC_DAEMON_PORT: "8332"
      BTC_DAEMON_USER: "umbrel"
      BTC_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      NMC_DAEMON_HOST: "namecoind"
      NMC_DAEMON_PORT: "8336"
      NMC_DAEMON_USER: "umbrel"
      NMC_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      LTC_DAEMON_HOST: "litecoind"
      LTC_DAEMON_PORT: "9332"
      LTC_DAEMON_USER: "umbrel"
      LTC_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      DOGE_DAEMON_HOST: "dogecoind"
      DOGE_DAEMON_PORT: "22555"
      DOGE_DAEMON_USER: "umbrel"
      DOGE_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      PEP_DAEMON_HOST: "pepecoind"
      PEP_DAEMON_PORT: "29373"
      PEP_DAEMON_USER: "umbrel"
      PEP_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      REDIS_HOST: "redis"
      REDIS_PORT: "6379"
      MYSQL_HOST: "mariadb"
      MYSQL_PORT: "3306"
      MYSQL_USER: "coiniumserv"
      MYSQL_PASS: "coiniumserv"
      MYSQL_DB: "coiniumserv"
      DATA_DIR: "/app/data"
      MONO_THREADS_PER_CPU: "100"
    ports:
      - "3333:3333"
      - "3434:3434"
      - "3380:8080"
    volumes:
      - ${APP_DATA_DIR}/data/coiniumserv:/app/data
      - ${APP_DATA_DIR}/web-ui/server.js:/app/web-ui/server.js

networks:
  default:
    enable_ipv6: true
    ipam:
      config:
        - subnet: fd00:dead:beef::/48
