services:

  # Bitcoin Core (SHA256 parent chain)
 bitcoind:
    image: lncm/bitcoind:v27.2
    restart: on-failure
    stop_grace_period: 15m
    user: "1000:1000"
    volumes:
      - ${APP_DATA_DIR}/data/bitcoin:/data/.bitcoin
    command:
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=8332
      - -port=8333
      - -txindex=1
      - -printtoconsole
      - -dbcache=450

  # Namecoin Core (SHA256 auxiliary chain, merge-mined with Bitcoin)
  namecoind:
    image: sevenrats/namecoin-core:latest
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/namecoin:/root/.namecoin
    command:
      - namecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=8336
      - -port=8334
      - -txindex=1
      - -printtoconsole

  # Litecoin Core (Scrypt parent chain)
  litecoind:
    image: uphold/litecoin-core:0.21
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/litecoin:/home/litecoin/.litecoin
    command:
      - litecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=9332
      - -port=9333
      - -txindex=1
      - -printtoconsole

  # Dogecoin Core (Scrypt auxiliary chain, merge-mined with Litecoin)
  dogecoind:
    image: casperstack/dogecoin:latest
    restart: on-failure
    stop_grace_period: 15m
    volumes:
      - ${APP_DATA_DIR}/data/dogecoin:/home/dogecoin/.dogecoin
    command:
      - dogecoind
      - -server=1
      - -rpcuser=umbrel
      - -rpcpassword=${APP_PASSWORD:-umbrel}
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -rpcport=22555
      - -port=22556
      - -txindex=1
      - -printtoconsole

  # Redis (share & stats storage)
  redis:
    image: redis:7-alpine
    restart: on-failure
    command: redis-server --appendonly yes --save 60 1 --maxmemory 256mb --maxmemory-policy allkeys-lru
    volumes:
      - ${APP_DATA_DIR}/data/redis:/data

  # CoiniumServ + Web Dashboard
  app_proxy:
    image: getumbrel/app-proxy:1.0.0
    environment:
      APP_HOST: mining-coiniumserv_coiniumserv_1
      APP_PORT: 8080
    ports:
      - "8080:8080"

  coiniumserv:
    image: ghcr.io/bobparkerbob888-tech/coiniumserv-mining-pool:latest
    restart: on-failure
    depends_on:
      - bitcoind
      - namecoind
      - litecoind
      - dogecoind
      - redis
    environment:
      APP_PASSWORD: ${APP_PASSWORD:-umbrel}
      BTC_DAEMON_HOST: "bitcoind"
      BTC_DAEMON_PORT: "8332"
      BTC_DAEMON_USER: "umbrel"
      BTC_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      NMC_DAEMON_HOST: "namecoind"
      NMC_DAEMON_PORT: "8336"
      NMC_DAEMON_USER: "umbrel"
      NMC_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      LTC_DAEMON_HOST: "litecoind"
      LTC_DAEMON_PORT: "9332"
      LTC_DAEMON_USER: "umbrel"
      LTC_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      DOGE_DAEMON_HOST: "dogecoind"
      DOGE_DAEMON_PORT: "22555"
      DOGE_DAEMON_USER: "umbrel"
      DOGE_DAEMON_PASS: "${APP_PASSWORD:-umbrel}"
      REDIS_HOST: "redis"
      REDIS_PORT: "6379"
      DATA_DIR: "/app/data"
    ports:
      - "3333:3333"
      - "3334:3334"
      - "3380:8080"
    volumes:
      - ${APP_DATA_DIR}/data/coiniumserv:/app/data
